<!DOCTYPE html>
<html lang="en" class="nowhitespace">
	<head>
		<meta name="description" content="Beam editor for show lasers.">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Beat alignment</title>
		<link rel="stylesheet" href="./svgtest.css" />
	</head>
	<body>
        <input id="zoom" type="range" min="1" max="1000" value="1" step="0.001"></input>
        <input id="scroll" type="range" min="0" max="1" value="0" step="0.00001"></input>
        <div id="container"></div>
        <script type="module">
            import {WaveDisplay} from './wavedisplay.js';

            // Set up audio context
            window.AudioContext = window.AudioContext || window.webkitAudioContext;
            const audioContext = new AudioContext();

            // Get the audio data
            fetch('./I_have_been_waiting_for_you.mp3')
            //fetch('./Aurora-Ordinary_World_(Above_Beyond_remix).mp3')
                .then(response => response.arrayBuffer())
                .then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))
                .then(audioBuffer => {
                    // Create the UI to display the waveform
                    let waveDisplay = new WaveDisplay({
                        data: audioBuffer.getChannelData(0),
                        parent: document.querySelector('#container'),
                        samplesPerPoint: 30,
                        sampleRate: audioBuffer.sampleRate,
                        zoomRate: 0.1,
                        zeroIsMiddle: false,
                    });

                    window['waveDisplay'] = waveDisplay;

                    // A way to implement an external zoom command
                    let zoom = document.querySelector('#zoom');
                    zoom.addEventListener('input', (e)=>{
                        waveDisplay.zoom = Number(e.target.value);
                    });
                
                    // A way to obtain a time in seconds in the wave form.
                    document.querySelector('#container').addEventListener('click', (e)=>{
                        //console.log('Time in seconds: ' + waveDisplay.getSeconds(e.clientX));
                        //console.log('index: ' + waveDisplay.getIndex(e.clientX));
                    }, { passive: false });
                });
        </script>
    </body>
</html>
